<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"/></script>
<script> gitbook.events.bind("page.change", function() { MathJax.Hub.Queue(["Typeset",MathJax.Hub]); } </script>

# Wythoff Game - 威佐夫博弈

--------

#### 问题

$$ A $$和$$ B $$两人轮流从两堆物品中取出物品，数量分别为$$ n $$和$$ m $$且$$ n \ne m $$。

每人每次既可以从一堆物品中取$$ (1 - p) $$（至少取$$ 1 $$个，至多取$$ p $$个。$$ n, m, p $$都是正整数且$$ p \lt n, p \lt m $$）个物品，也可以从两堆物品中同时取$$ (1 - p) $$个物品，最后一个把物品取光的人获胜。

给定$$ n, m, p $$，当我方先手，我方和对方都是高手（在能赢的情况下一定能赢），求我方是否能赢。

#### 解法

$$ (1) $$ 当我方面临$$ (0, 0) $$局势时，我方输了，因为对方已经把两堆物品取光，称$$ (0, 0) $$是最终局势。

$$ (2) $$ 当我方面临$$ (s, t) $$局势（其中$$ s \ne t, 1 \ge s, t \ge p $$）时，我方必输，因为我方无法一次把两堆物品取光。

$$ (3) $$ 当我方面临$$ (s, s) $$局势（其中$$ 1 \ge s \ge p $$）时，我方必赢，因为我方可以一次将两堆物品取光。

$$ (4) $$ 当我方面临$$ (0, s) $$局势（其中$$ 1 \ge s \ge p $$）时，我方必赢，因为我方可以一次将剩下那一堆物品取光。

$$
\cdots
$$

可以看出，当留给对方$$ p + 1 $$个物品时，下一轮对方必然会输，因为对方必然取$$ (1 - p) $$个物品，留给我方$$ (1 - p) $$个物品。称这样的物品数量为必赢数量$$ w = p + 1 $$。这样必然输的局势称为奇异局势（$$ Cold Position $$）。

当我方取物品时面对$$ w $$的倍数个物品时，我方必输，即$$ n \mod (p + 1) = 0 $$。否则对方必输。

该算法的时间复杂度为$$ O(1) $$。

其中a(k)与b(k)交换位置后仍然是等价的，为了方便设a(k) <= b(k)
前几个奇异局势是：
k  0  1  2  3  4  5  6  7  8  9  ...
a  0  1  3  4  6  8  9  11 12 14 ...
b  0  2  5  7  10 13 15 18 20 23 ...
即(a(0), b(0)) = (0, 0)，k = 0
(a(1), b(1)) = (1, 2)，k = 1
(a(2), b(2)) = (3, 5)，k = 2
...

2)局势的性质
性质1：
任何自然数都包含于且仅包含于一个奇异局势中
且a(k) > a(k-1)，b(k) > b(k-1)，b(k) = a(k) + k
性质2：
任意操作都可以将奇异局势改变为非奇异局势(Hot Position)
性质3：
通过适当的方法可以将非奇异局势变为奇异局势

3)计算奇异局势序列
原始的计算方法是初始k = 0时a(0) = 0，b(0) = 0
以后递归的计算k = 1，k = 2，k = 3...的情况
对于k = i，a(i)取之前0到i-1中尚未使用的最小自然数作为a(i)的值，而b(i) = a(i) + i
比如对于：
k  0  1  2  3  4  5  6  7  8  9  
a  0  1  3  4  6  8  9  11 12 14 
b  0  2  5  7  10 13 15 18 20 23 
当k = 10时，a(10)取从0到9中尚未使用过的最小自然数16，b(10) = 16 + 10 = 26

更快的方式是用黄金分割方法，由威佐夫(Wythoff)提出，该算法也由他的名字命名
黄金分割Golden Ratio是x^2 = x + 1的正值解，设t为根号5，则黄金分割为(1+t)/2
从黄金分割有：

k						0  1	  2		 3	    4	   5	  6		
k*golden_ratio		0  1.618  3.236  4.854  6.472  8.090  9.708
a						0  1	  3	     4		6	   8	  9
k*(golden_ratio+1)	0  2.618  5.236  7.854  10.472 13.090 15.708
b						0  2	  5		 7		10	   13	  15

则可以得到结论，对于i >= 0，a(i)取小于i*golden_ratio的最大整数
//其中i*golden_ratio一定是一个无理数，大于a(i)小于a(i)+1
//
//4)局势变换策略
//从上文可知令对手处于奇异局势(a(k), b(k))即可获胜
//因此获胜关键在于将非奇异局势转化为奇异局势
//非奇异局势(a, b)有5种情况：
//a = b						第1种情况
//a = a(k), b > b(k)		第2种情况
//a = a(k), b < b(k)		第3种情况
//第1种情况：
//将a和b两堆同时取完，令对方面临(0, 0)奇异局势
//第2种情况：
//从b中取b - b(k)数量的物品，使b = b(k)，令对方面临(a(k), b(k))奇异局势
//第3种情况：
//i)若b > a，这时必然存在这样一个t = b - a，从a和b中同时取a - a(t)数量的物品
//因为有b(k) = a(k) + k，则有b - (a - a(t)) = b - a + a(t) = b - a + b(t) - t = b(t)
//同时取出a - a(t)物品后使a = a(t)，b = b(t)，令对方面临(a(t), b(t))奇异局势
//ii)若b < a，则不能b - a，因为本文问题中都是非负整数的计算
//则需求出b在奇异局势数组中的下标k'
//从a中取a - a(k')个物品，使a = a(k')，令对方面临(a(k'), b(k'))奇异局势
//
//网络上流行的中文文档中关于这里的情况划分通常是5种
//但其中第3种情况的讲解非常糟糕，因为网络文档中将局势中a和b的下标k搞混，容易令人误解
//经过总结本文将5种情况进行了筛选，经过测试是正确的
//
//本文引用了“Wythoff’s Game”，作者“Kimberly Hirschfeld-Cotton(Oshkosh, Nebraska)”
